---
title: "Analysis of Burridge et al., 2016 RNA-seq data"
date: 2016-05-03
output:
  html_document:
    toc: true
    toc_float: true
---

**Last updated:** `r Sys.Date()`

**Code version:** `r system("git log -1 --format='%H'", intern = TRUE)`

```{r chunk-options}
library("knitr")
opts_chunk$set(cache = TRUE)
```

Initial quick analysis of RNA-seq data from [Burridge et al., 2016][burridge2016].

[burridge2016]: http://www.ncbi.nlm.nih.gov/pubmed/27089514

## Setup

```{r packages, message=FALSE}
library("dplyr")
library("tidyr")
library("ggplot2")
library("cowplot")
theme_set(theme_bw(base_size = 12))
```


```{r}
table_s2 <- read.delim("../data/burridge-2016-table-s2.txt",
                       stringsAsFactors = FALSE)
tpm_raw <- read.delim("../data/burridge-2016-tpm.txt", stringsAsFactors = FALSE)
```

Prepare data files.

```{r}
gene_info <- tpm_raw %>% select(ensembl_gene_id, chromosome_name,
                                external_gene_name, gene_biotype)
tpm <- tpm_raw %>% select(ends_with("um"))
anno <- data.frame(id = colnames(tpm))
anno <- anno %>% mutate(id = sub("\\.", "-", id))
anno <- separate(anno, id, into = c("individual", "treatment"), sep = "-",
                 remove = FALSE)
```

## Remove lowly expressed genes

Median log2 tpm.

```{r}
tpm_log2_median <- apply(log2(tpm + 1), 1, median)
hist(tpm_log2_median)
cutoff <- 2
abline(v = cutoff, col = "red")
```

Keeping the `r sum(tpm_log2_median > cutoff)` genes with a median log2 tpm greater than `r cutoff`.

```{r}
tpm_clean <- tpm %>% filter(tpm_log2_median > cutoff)
```

## PCA

```{r}
pca <- prcomp(t(tpm_clean), scale. = TRUE)
variances <- pca$sdev^2
explained <- variances / sum(variances)
plot(pca)
```

```{r}
pca_data <- cbind(anno, pca$x[, 1:5])
```

PC1 versus PC2.

```{r pc1-pc2-id}
ggplot(pca_data, aes(x = PC1, y = PC2)) +
  geom_text(aes(label = id)) +
  labs(x = sprintf("PC%d (%.2f%%)", 1, round(explained[1] * 100, 2)),
       y = sprintf("PC%d (%.2f%%)", 2, round(explained[2] * 100, 2)))
```

PC3 versus PC4.

```{r pc3-pc4-id}
ggplot(pca_data, aes(x = PC3, y = PC4)) +
  geom_text(aes(label = id)) +
  labs(x = sprintf("PC%d (%.2f%%)", 3, round(explained[3] * 100, 2)),
       y = sprintf("PC%d (%.2f%%)", 4, round(explained[4] * 100, 2)))
```

PC1 separates by treatment. PC2 separates by individual.

```{r pca-plot}
plot_grid(ggplot(pca_data, aes(x = treatment, y = PC1)) + geom_boxplot(),
          ggplot(pca_data, aes(x = individual, y = PC1)) + geom_boxplot(),
          ggplot(pca_data, aes(x = treatment, y = PC2)) + geom_boxplot(),
          ggplot(pca_data, aes(x = individual, y = PC2)) + geom_boxplot())
```

## Hierarchical clustering

```{r dendrogram}
d <- dist(t(tpm_clean))
h <- hclust(d)
plot(h, labels = anno$id)
```

## Session information

```{r info}
sessionInfo()
```
